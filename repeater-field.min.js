/*
 * Repeater Field JS v1.0
 *
 * Author: Brutenis Jusaitis
 * Github rep: https://github.com/Brutenis/Repeater-Field-JS
 */

function RepeaterField(t,e){this.params=e||new Object,this.setDefault=((t,e,a)=>{t[e]||(t[e]=a)}),this.defaultField={classList:["repeater-text-input"],type:"text",name:"repeater-text-input",placeholder:"Type here..."},this.generateId=(t=>{let e=new String;for(let a=0;a<t;a++)e+="abcdef123456".charAt(Math.floor(Math.random()*"abcdef123456".length));return e}),this.id=this.generateId(6),this.setDefault(this.params,"fields",{}),this.setDefault(this.params.fields,"wrapper",{}),this.setDefault(this.params.fields.wrapper,"element","div"),this.setDefault(this.params.fields.wrapper,"classList",["repeater-field-wrapper"]),this.setDefault(this.params.fields,"row",{}),this.setDefault(this.params.fields.row,"element","div"),this.setDefault(this.params.fields.row,"classList",["repeater-input-row"]),this.setDefault(this.params.fields,"inputs",new Array),this.setDefault(this.params.fields.inputs,0,this.defaultField),this.setDefault(this.params,"deleteButton",{}),this.setDefault(this.params.deleteButton,"value","Delete"),this.setDefault(this.params.deleteButton,"classList",["repeater-delete-button"]),this.setDefault(this.params.deleteButton,"name","repeater-delete-button"),this.setDefault(this.params,"addButton",{}),this.setDefault(this.params.addButton,"value","Add"),this.setDefault(this.params.addButton,"classList",["repeater-add-button"]),this.setDefault(this.params.addButton,"name","repeater-add-button"),this.setDefaultData=(()=>{this.data=[[]],this.params.fields.inputs.forEach(t=>{this.data[0].push("")})}),this.params.data?this.data=this.params.data:this.setDefaultData(),this.fieldWrapperId=`repeater-field-wrapper-${this.id}`,this.fieldRowId=`repeater-field-row-${this.id}`,this.deleteButtonId=`repeater-delete-${this.id}`,this.addButtonId=`repeater-add-${this.id}`,this.inputId=`repeater-input-${this.id}`,this.getData=(()=>this.data),this.createInputElement=((t,e)=>{let a=new Object;if("textarea"!=e.type?(a=document.createElement("input"),"text"==e.type||"number"==e.type||"url"==e.type||"time"==e.type||"tel"==e.type||"range"==e.type||"password"==e.type||"month"==e.type||"email"==e.type||"datetime-local"==e.type||"date"==e.type||"color"==e.type?a.setAttribute("type",e.type):a.setAttribute("type","text"),e.name?a.setAttribute("name",e.name):a.setAttribute("name","repeater-input"),e.placeholder?a.setAttribute("placeholder",e.placeholder):a.setAttribute("placeholder","Type here...")):(a=document.createElement("textarea"),e.name?a.setAttribute("name",e.name):a.setAttribute("name","repeater-textarea"),e.placeholder?a.setAttribute("placeholder",e.placeholder):a.setAttribute("placeholder","Type here...")),e.classList&&e.classList[0]&&e.classList.forEach(t=>{a.classList.add(t)}),t&&a.setAttribute("data-id",t),e.wrapper){const t=this.createWrapper(!1,e.wrapper);return t.appendChild(a),t}return a}),this.createButton=((t,e)=>{const a=document.createElement("button");if(a.innerText=e.value,e.name?a.setAttribute("name",e.name):a.setAttribute("name","repeater-button"),t&&a.setAttribute("data-id",t),e.classList&&e.classList[0]&&e.classList.forEach(t=>{a.classList.add(t)}),e.wrapper){const t=this.createWrapper(!1,e.wrapper);return t.appendChild(a),t}return a}),this.createWrapper=((t,e)=>{const a=document.createElement(e.element);return e.classList&&e.classList[0]&&e.classList.forEach(t=>{a.classList.add(t)}),t&&a.setAttribute("data-id",t),a}),this.updateData=(()=>{if(document.querySelector(`[data-id="${this.fieldRowId}"]`)){let t=new Array;Array.from(document.querySelectorAll(`[data-id="${this.fieldRowId}"]`)).forEach(e=>{const a=Array.from(e.getElementsByTagName("*")),s=new Array;a.forEach(t=>{"INPUT"!=t.nodeName&&"TEXTAREA"!=t.nodeName||s.push(t.value)}),t.push(s)}),this.data=t}else this.setDefaultData()}),this.addNewRow=(()=>{const t=new Array;this.params.fields.inputs.forEach(e=>{t.push("")}),this.data.push(t),this.render()}),this.render=(()=>{t.innerHTML="";const e=this.createWrapper(this.fieldWrapperId,this.params.fields.wrapper),a=this.createButton(this.addButtonId,this.params.addButton);this.data.forEach(t=>{const a=this.createWrapper(this.fieldRowId,this.params.fields.row),s=this.createButton(this.deleteButtonId,this.params.deleteButton);t.forEach((t,e)=>{let i=new Object;"INPUT"!=(i=this.params.fields.inputs[e]?this.createInputElement(this.inputId,this.params.fields.inputs[e]):this.createInputElement(this.inputId,this.defaultField)).nodeName&&"TEXTAREA"!=i.nodeName?i.firstChild.value=t:i.value=t,i.addEventListener("input",this.updateData),a.appendChild(i),a.appendChild(s)}),a.appendChild(s),e.appendChild(a)}),t.appendChild(e),t.appendChild(a),Array.from(document.querySelectorAll(`[data-id="${this.deleteButtonId}"]`)).forEach((t,e)=>{t.addEventListener("click",()=>{this.data.splice(e,1),this.data.length<1&&this.setDefaultData(),this.render()})}),"BUTTON"!=a.nodeName?a.firstChild.addEventListener("click",this.addNewRow):a.addEventListener("click",this.addNewRow)}),this.render()}
